# Week 11: Tidyverseãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ã¨å¯è¦–åŒ–

```{r, include=FALSE}
library(gt)
library(tidyverse)
```

## ãƒ¡ãƒ¢
- è£œè¬›ï¼ˆ2025/7/5ï¼‰

## äº‹å‰ã®ç¢ºèª

- ã“ã®è¬›ç¾©ã®Rãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã„ã¦ã„ã¾ã™ã‹ï¼Ÿ
- è‹±æ•°å­—ã§åå‰ã‚’ä»˜ã‘ãŸæœ¬æ—¥ã®è¬›ç¾©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã‹ï¼Ÿ

  - .Rã§ã‚‚.Rmdã§ã‚‚ã©ã¡ã‚‰ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

## ä»Šæ—¥ã®ç›®æ¨™

1. ```tidyverse```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã„ã€ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ãŒå‡ºæ¥ã‚‹
2. ```ggplot2```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã„ã€ãƒ‡ãƒ¼ã‚¿ã®æç”»ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹

## ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥

### tidy data

- RãŒå‡¦ç†ã—ã‚„ã™ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ã“ã¨

- Hadley WickhamãŒæå”±ã—ãŸè€ƒãˆã§ä»¥ä¸‹ã®ä¸‰ã¤ã®å®šç¾©ãŒã‚ã‚‹

  1. 1ã¤ã®åˆ—ãŒ1ã¤ã®å¤‰æ•°ã‚’è¡¨ã™
  
  2. 1ã¤ã®è¡ŒãŒ1ã¤ã®è¦³æ¸¬ã‚’è¡¨ã™
  
  3. 1ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ1ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã ã‘ã‚’å«ã‚€

::: infobox
æ˜¨å¹´ã€LINEãƒ¤ãƒ•ãƒ¼æœ¬ç¤¾ã§è¡Œã‚ã‚ŒãŸJapan.Rã«æ¥æ—¥ã•ã‚Œã¦ã¾ã—ãŸï¼<br>
- [Japan.R 2024ãŒç´€å°¾äº•ç”ºã‚ªãƒ•ã‚£ã‚¹ã§é–‹å‚¬ã•ã‚Œã¾ã—ãŸ!!](https://techblog.lycorp.co.jp/ja/20241224c)
:::

- tidyã§ãªã„ãƒ‡ãƒ¼ã‚¿
```{r}
untidy_data <- data.frame(
  Name = c("Alice", "Bob", "Carol"),
  Japanese = c(80, 90, 85),
  Math = c(75, 88, 92)
)

gt::gt(untidy_data)
```


- tidyãƒ‡ãƒ¼ã‚¿
```{r, echo=FALSE}
tidy_data <- pivot_longer(
  untidy_data,
  cols = c(Japanese, Math),
  names_to = "Subject",
  values_to = "Score"
)
gt(tidy_data)
```

### ```tidyverse```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆ[https://www.tidyverse.org/](https://www.tidyverse.org/)ï¼‰

```{r, comment=NA}
tidyverse_logo()
```


### ãƒ‡ãƒ¼ã‚¿ã®å¤‰å½¢ï¼ˆç¸¦é•· ğŸ”„ æ¨ªé•·ï¼‰
- æ¨ªé•·ï¼ˆtidyã§ãªã„ï¼‰ã‚’ç¸¦é•·ã«

```{r}
untidy_data
```


```{r}
#install.packages("tidyverse")
library(tidyverse)

tidy <- pivot_longer(
  untidy_data,               #ãƒ‡ãƒ¼ã‚¿
  cols = c(Japanese, Math),ã€€#å¤‰å½¢ã™ã‚‹åˆ—
  names_to = "Subject",      #ã‚­ãƒ¼ã®åˆ—ã®åå‰
  values_to = "Score"        #å€¤ã®åˆ—ã®åå‰
)

tidy
```

- æ¨ªé•·ã«æˆ»ã™

  - ç¸¦é•·ã®ãƒ‡ãƒ¼ã‚¿ã§ã¯è¡Œãˆãªã„åˆ†æã‚‚ã‚ã‚Šã¾ã™
  
```{r}
untidy <- pivot_wider(
  tidy,                      #ãƒ‡ãƒ¼ã‚¿
  names_from = "Subject",    #ã‚­ãƒ¼ã®åˆ—
  values_from = "Score"      #å€¤ã®åˆ—
)

untidy
```

### ```dplyr```ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®æ“ä½œ
- ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯```tidyverse```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚Œã°ä½¿ãˆã¾ã™ã€‚

- ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ¯å›å¤‰æ•°ã«ä¿å­˜ã›ãšãƒ‡ãƒ¼ã‚¿ã‚’æ“ä½œã§ããŸã‚Šã€äºŒã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã—ãŸã§ãã‚‹ã€‚

- ```%>%```ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ã‚’ä½¿ç”¨ã™ã‚‹ã€‚```|>```ãªã©æ§˜ã€…ãªãƒ‘ã‚¤ãƒ—ãŒã‚ã‚‹ãŒã€ã¨ã‚Šã‚ãˆãšã¯```%>%```ã ã‘ã‚’è¦šãˆã¦ã„ã‚Œã°ã‚ˆã„ã€‚

- ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ã‚’ä½¿ã£ãŸãƒ‡ãƒ¼ã‚¿æ“ä½œã®ä¾‹ï¼ˆã‚¨ã‚¯ã‚»ãƒ«ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’Rã®ã‚³ãƒ¼ãƒ‰ã§è¡Œã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ï¼‰

```{r}
colnames(mpg)

mpg %>%
  # åˆ—ã‚’çµã‚‹
  dplyr::select(manufacturer, model, displ, year, cyl) %>%
  # è¡Œã‚’çµã‚‹
  dplyr::filter(manufacturer == "audi") %>%
  # yearåˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’100ã§å‰²ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€centuryã¨ã„ã†æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
  dplyr::mutate(century = year / 1000) %>%
  # ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®5è¡Œã‚’è¡¨ç¤º
  head(,5)
```

#### ```filter```é–¢æ•°
- æ¡ä»¶ã‚’æº€ãŸã™è¡Œã®ã¿ã«ãƒ‡ãƒ¼ã‚¿ã‚’çµã‚‹

- æŒ‡å®šã—ãŸå€¤ã¨åŒã˜

  - æ•°å€¤å‹ã®å ´åˆã¯""å…¥ã‚Œãªãã¦ã‚ˆã„

```{r, eval=FALSE}
mpg %>%
  filter(manufacturer == "audi")
```

- æŒ‡å®šã—ãŸå€¤ä»¥å¤–

```{r, eval=FALSE}
mpg %>%
  filter(manufacturer != "audi")
```

- æŒ‡å®šã—ãŸå€¤ã‚ˆã‚Šå¤§ãã„ï¼ˆ > ï¼‰/å°ã•ã„ï¼ˆ < ï¼‰

  - ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€cylåˆ—ã®ãƒ‡ãƒ¼ã‚¿ã§6ã‚ˆã‚Šã‚‚å¤§ãã„å€¤ã‚’å–ã‚Šå‡ºã™å‘½ä»¤
  
```{r}
mpg %>%
  filter(cyl > 6)
```

- ```=```ã‚’ä»˜ã‘ã‚‹ã¨ä»¥ä¸Šï¼ˆ >= ï¼‰/ä»¥ä¸‹ï¼ˆ <= ï¼‰ã‚’è¡¨ã™

```{r, eval=FALSE}
mpg %>%
  filter(cyl >= 6)
```

- NAã®ãƒ‡ãƒ¼ã‚¿ä»¥å¤–

  - ```filter(is.na(cyl))```ã ã¨NAã®ãƒ‡ãƒ¼ã‚¿ã‚’çµã‚Šè¾¼ã‚€

```{r, eval=FALSE}
mpg %>%
  filter(!is.na(cyl))
```

- è¤‡æ•°æ¡ä»¶ã®æŒ‡å®šã‚‚ã§ãã‚‹

  - ä»¥ä¸‹ã§ã¯ã€audiä»¥å¤–ã®è»Š**ã‹ã¤**cylãŒ6ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã«çµã‚Šè¾¼ã‚“ã§ã„ã‚‹

```{r, eval=FALSE}
mpg %>%
  filter(manufacturer != "audi" & cyl >= 6)
```

  - ä»¥ä¸‹ã§ã¯ã€audiä»¥å¤–ã®è»Š**ã‚‚ã—ãã¯**cylãŒ6ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã«çµã‚Šè¾¼ã‚“ã§ã„ã‚‹

```{r, eval=FALSE}
mpg %>%
  filter(manufacturer == "audi" | cyl >= 6)
```
  - ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€ã©ã¡ã‚‰ã®æ¡ä»¶ã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’çµã‚Šè¾¼ã‚€

```{r, eval=FALSE}
mpg %>%
  filter(!(manufacturer == "audi" | cyl >= 6))
```

#### ```arrange```é–¢æ•°

- è¡Œã‚’ä¸¦ã³æ›¿ãˆã‚‹é–¢æ•°

- æ˜‡é †

```{r, eval=FALSE}
mpg %>%
  arrange(cty)
```

- è¤‡æ•°åˆ—ã§ã®æ˜‡é †

```{r, eval=FALSE}
mpg %>%
  arrange(cty, hwy)
```

- é™é †
  
  - ```desc```é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã€‚```arrange(-åˆ—å)```ã§ã‚‚ä¸¦ã³å¤‰ãˆã‚‰ã‚Œã‚‹ãŒã€ã“ã‚Œã¯æ•°å€¤å‹ã«ã—ã‹ä½¿ç”¨ã§ããªã„

```{r, eval=FALSE}
mpg %>%
  arrange(desc(cty))
```


#### ```select```é–¢æ•°
- åˆ—ã®çµã‚Šè¾¼ã¿ã‚’è¡Œã†

  - è¤‡æ•°ã®åˆ—ã‚’çµã‚Šè¾¼ã‚ã‚‹

```{r, eval=FALSE}
mpg %>%
  select(model, trans)
```

  - æŒ‡å®šã—ãŸåˆ—ä»¥å¤–ã‚’çµã‚Šè¾¼ã‚€
  
```{markdown}
mpg %>%
  select(-year)

mpg %>%
  select(!year)
```

  - åˆ—åã‚’å¤‰ãˆãªãŒã‚‰çµã‚Šè¾¼ã‚€

```{r, eval=FALSE}
mpg %>%
  select(Changed_model = model, Changed_trans = trans)
```

- ãƒ‡ãƒ¼ã‚¿ã®çµã‚Šè¾¼ã¿ã‚’è¡Œã‚ãšã€åˆ—åã ã‘ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã€```rename```é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹

```{r, eval=FALSE}
mpg %>%
  rename(Changed_model = model, Changed_trans = trans)
```

::: infobox
ãƒ‡ãƒ¼ã‚¿ã®çµã‚Šè¾¼ã¿ãªã©ã®åŠ å·¥ã‚’è¡Œã£ãŸå ´åˆã€ãã‚Œã‚’ä¿å­˜ã—ãŸã„å ´åˆã€ï¼ˆæ–°ã—ã„ï¼‰å¤‰æ•°ã«ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ä¸€èˆ¬çš„ã«ä»¥ä¸‹ã®äºŒã¤ã®ä¿å­˜ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

```{r, eval=FALSE}
mpg_renamed <- mpg %>%
  rename(Changed_model = model, Changed_trans = trans)

mpg %>%
  rename(Changed_model = model, Changed_trans = trans) -> mpg_renamed 
```

:::

#### ```mutate```é–¢æ•°
- åˆ—ã‚’æ–°ã—ãè¿½åŠ ã™ã‚‹ã€‚åŒã˜åˆ—åã‚’æŒ‡å®šã™ã‚Œã°ã€æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚

  - æ—¢å­˜ã®cylã®ãƒ‡ãƒ¼ã‚¿ã‚’100ã§å‰²ã£ãŸæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’cyl_percentã¨ã„ã†æ–°ã—ã„åˆ—ã‚’ä½œæˆã€‚

```{r, eval=FALSE}
mpg %>%
  mutate(cyl_percent = cyl / 100)
```

  - ```if_else```é–¢æ•°ã‚’ç”¨ã„ã¦æ¡ä»¶æŒ‡å®šã‚’è¡Œã„ã€cylãŒ6ä»¥ä¸Šãªã‚‰ã€Œ6ä»¥ä¸Šã€, ãã‚Œä»¥å¤–ãªã‚‰ã€Œ6æœªæº€ã€ã‚’å«ã‚€æ–°ãŸãªåˆ—ã‚’ä½œæˆã€‚ã•ã‚‰ã«ã€```.after =```ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã€åˆ—ã®ä½ç½®ã‚’æŒ‡å®šã€‚æ¨™æº–åœ°ã§ã¯ã€æ–°ã—ãä½œæˆã•ã‚ŒãŸåˆ—ã¯ã€ä¸€ç•ªæœ€å¾Œã«è¿½åŠ ã•ã‚Œã‚‹ã€‚

```{r, eval=FALSE}
mpg %>%
  mutate(cyl_6 = if_else(cyl >= 6, "6ä»¥ä¸Š", "6æœªæº€"), .after = cyl)
```

#### ```summarize``` + ```group_by```é–¢æ•°

- ```summarise```é–¢æ•°ã¯å¹³å‡å€¤ã‚„åˆ†æ•£ã‚’è¨ˆç®—ã—ãŸã‚Šãªã©ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆã™ã‚‹é–¢æ•°

  - ```mutate```é–¢æ•°ã®ã‚ˆã†ã«ã€è¨ˆç®—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ–°ã—ã„åˆ—ã«æ ¼ç´ã™ã‚‹

```{r}
mpg %>%
  summarise(M = mean(displ))
```

```{r}
mpg %>%
  summarise(max = max(displ))
```

- ```group_by```é–¢æ•°ã¨ã„ã†ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã›ã‚‹é–¢æ•°ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã»ã¨ã‚“ã©

  - manufacturerã”ã¨ã®å¹³å‡å€¤ã‚’ç®—å‡º

```{r}
mpg %>%
  group_by(manufacturer) %>%
  summarise(M = mean(displ), .groups = "drop") %>%
  head(5)
```

::: infobox
```group_by```é–¢æ•°ã‚’ä½¿ç”¨ã—ãŸã‚‰ã€å¿…ãš```summarise```é–¢æ•°ã®ä¸­ã§```.groups = "drop"```ã‚’æŒ‡å®šã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚’è§£é™¤ã™ã‚‹ã“ã¨ã€‚ãã†ã—ãªã„ã¨äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ã«ã¤ãªãŒã£ãŸã‚Šã‚‚ã™ã‚‹ã€‚
:::

### ```dplyr```ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿çµåˆ
- äºŒã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ãã‚Œãã‚Œã®å…±é€šã®ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«çµåˆã™ã‚‹

  - è‹±å˜èªã®åå¿œé€Ÿåº¦ã®å®Ÿé¨“ãªã©ã§ã€å¾Œã‹ã‚‰é »åº¦ãªã©ã®æƒ…å ±ã‚’ä»˜ã‘åŠ ãˆãŸã„ãªã©ã‹ãªã‚Šé‡å®ã—ã¾ã™

- ç–‘ä¼¼ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
```{r}
students <- data.frame(
  id = c(1, 2, 3, 4),
  name = c("Alice", "Bob", "Charlie", "David")
)

scores <- data.frame(
  id = c(1, 2, 3, 4),
  score = c(80, 90, 85, 70)
)
```

#### ```inner_join```é–¢æ•°

- äºŒã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯åŒã˜```id```ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ã€‚ã“ã®ã‚­ãƒ¼ã‚’ã‚‚ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã—ã¾ã™ã€‚ãã—ã¦```joined_data```ã¨ã„ã†æ–°ã—ã„å¤‰æ•°ã«ä¿å­˜ã—ã¾ã™ã€‚

```{r}
students

scores
```

```{r}
joined_data <- students %>%
  dplyr::inner_join(scores, by = "id")

joined_data
```

- åˆ—åãŒãã‚ã£ã¦ã„ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚Œã°OK

```{r}
students <- data.frame(
  id = c(1, 2, 3, 4),
  name = c("Alice", "Bob", "Charlie", "David")
)

scores <- data.frame(
  å­¦ç±ç•ªå· = c(1, 2, 3, 4),
  score = c(80, 90, 85, 70)
)
```

```{r}
students
scores
```

```{r}
joined_data <- students %>%
  dplyr::inner_join(scores, by = c("id" = "å­¦ç±ç•ªå·"))

joined_data
```

- ```inner_join```ã§ã¯å…±é€šã—ã¦ã„ãªã„å¤‰æ•°ã¯å‰Šé™¤ã•ã‚Œã‚‹

```{r}
# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®ä½œæˆ
students <- data.frame(
  id = c(1, 2, 3, 4),
  name = c("Alice", "Bob", "Charlie", "David")
)

scores <- data.frame(
  id = c(2, 3, 4, 5),
  score = c(80, 90, 85, 70)
)
```

```{r}
students
scores
```

- äºŒã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«å…±é€šã—ã¦ã„ã‚‹```id```ã®2, 3, 4ã ã‘ãŒãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ®‹ã£ã¦ã„ã‚‹

```{r}
students %>%
  dplyr::inner_join(scores, by = "id")

```

#### ãã®ã»ã‹ã®```join```

- ```left_join```ã€```right_join```é–¢æ•°ã¯ãã‚Œãã‚Œå·¦å´ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã€å³å´ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã‚‹

  - æ®‹ã£ãŸãƒ‡ãƒ¼ã‚¿ã«ã¯```NA```ï¼ˆæ¬ æå€¤ï¼‰ã«ãªã‚‹

```{r}
students %>%
  dplyr::left_join(scores, by = "id")
```

```{r}
students %>%
  dplyr::right_join(scores, by = "id")
```

- ```full_join```ã ã¨å…¨éƒ¨ãŒæ®‹ã‚‹

```{r}
students %>%
  dplyr::full_join(scores, by = "id")
```

::: infobox
ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ã‚„çµåˆã‚’è¡Œã„ï¼ˆæ–°ã—ã„ï¼‰å¤‰æ•°ã«ä¿å­˜ã—ãŸå¾Œã¯å¿…ãšãã®ä¸­èº«ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::

## ```ggplot2```ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–

- ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚```tidyverse```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ã€‚å¾“ã£ã¦ã€```library(tidyverse)```ã§```ggplot2```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ä½¿ç”¨ã§ãã‚‹ã€‚

- **Grammar of Graphics**ã®æ€æƒ³ã«åŸºã¥ã„ã¦ã„ã‚‹

  - å¯è¦–åŒ–ã¨ã„ã†ä½œæ¥­ã‚’è¤‡æ•°ã®å·¥ç¨‹ã«åˆ†ã‘ã¦è€ƒãˆã‚‹
  
    - ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®é¸åˆ¥ã€ã‚°ãƒ©ãƒ•ã®é¸æŠã€ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ©ãƒ•ã«å‰²ã‚Šå½“ã¦ã‚‹
    
    - ã‚¹ãƒ†ãƒƒãƒ—ãƒ»ãƒã‚¤ãƒ»ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ‘ã‚ºãƒ«ã®ã‚ˆã†ã«ã‚°ãƒ©ãƒ•ã‚’ä½œã‚Šä¸Šã’ã¦ã„ã
  
::: infobox
æ…£ã‚Œã‚‹ã¨ã¨ã¦ã‚‚ä½¿ã„ã‚„ã™ã„ã§ã™ãŒã€ãã®åˆ†è¦šãˆã‚‹é–¢æ•°ãŒå¤šã„ã®ã§æ…£ã‚Œã‚‹ã¾ã§ãŒå°‘ã—å¤§å¤‰ã§ã™ã€‚ä½¿ç”¨ã™ã‚‹éš›ã«ãã®éƒ½åº¦èª¿ã¹ãŸã‚Šã™ã‚Œã°ã‚ˆãã€ã‚³ãƒ¼ãƒ‰ã‚’æš—è¨˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
:::

- ä¾‹ï¼ˆãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ï¼‰
  
 - ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ï¼ˆ```%>%```ï¼‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã—ãŸã‚‰å¾Œã¯```+```ã§ã‚°ãƒ©ãƒ•ã‚’å°‘ã—ãšã¤ä½œã‚Šä¸Šã’ã¦ã„ãã¾ã™
 
```{r}
mpg %>%
  ggplot() + 
  #aesã®ä¸­ã§xè»¸ã‚„yè»¸ã‚’æŒ‡å®šã€‚ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¯xè»¸ã®æŒ‡å®šã ã‘ã§ã‚ˆã„
  geom_histogram(mapping = aes(x = displ)) 
```

#### æ•£å¸ƒå›³ + ç›´ç·š

  - ç¬¬ä¸€æ®µéšï¼šæ•£å¸ƒå›³
  
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = cty)) +
  geom_point()

# ã©ã¡ã‚‰ã§ã‚‚OK
#mpg %>%
#  ggplot(mapping = aes(x = displ, y = cty)) +
#  geom_point()
```

- ç¬¬äºŒæ®µéšï¼šç›´ç·šã‚’é‡ã­ã‚‹

  - ```method = "lm"```ã§ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã§ç›´ç·šã‚’æ¨å®š

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = cty)) +
  geom_point() +
  geom_smooth(method = "lm")
```

- ç¬¬ä¸‰æ®µéšï¼šã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«è‰²åˆ†ã‘

  - ```group =```ã¨```color = ```ã§æŒ‡å®šã‚’è¡Œã†ã€‚æ•°å€¤ã®ãƒ‡ãƒ¼ã‚¿ã¯Factorå‹ã«ã™ã‚‹ã“ã¨ãŒå¿…è¦ãªå ´åˆã‚‚ã‚ã‚‹

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = cty,
                                 group = factor(cyl), color = factor(cyl))) +
  geom_point() +
  geom_smooth(method = "lm")
```

- ç¬¬å››æ®µéšï¼šãƒ•ã‚¡ã‚»ãƒƒãƒˆ

  - æ°´æº–ã”ã¨ã«å›³ã‚’åˆ†ã‘ã‚‹
  
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = cty)) +
  geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap( ~ cyl)
```

::: infobox
```ggplot2```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é™ã‚Šã¾ã›ã‚“ãŒã€ã„ã‚ã„ã‚ãªé–¢æ•°ã‚’è©¦ã—ã¦ã€å¤±æ•—ã—ã¦ã¨ã„ã†éŠã³ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚è‰²ã€…ãªã§ãƒ¼ãŸã§æ§˜ã€…ãªé–¢æ•°ã§ä½œå›³ã‚’ã—ã¦éŠã‚“ã§ãã ã•ã„ã€‚
:::

#### çµ±è¨ˆçš„å‡¦ç†

  - è»Šã®ã‚µã‚¤ã‚ºã”ã¨ã«ç‡ƒè²»ã®å¹³å‡ã‚’è¨ˆç®—ã™ã‚‹

```{r}
mpg %>%
  group_by(class) %>%
  summarise(M = mean(cty)) %>%
  arrange(M)
```

  - å¹³å‡å€¤ã‚’è¨ˆç®—ã›ãšæ£’ã‚°ãƒ©ãƒ•ã‚’æ›¸ãã¨å¹³å‡å€¤ã‚’æç”»ã§ãã¦ã„ãªã„

```{r}
mpg %>%
  ggplot(mapping = aes(x = class, y = cty)) +
  geom_bar(stat = "identity")
```

  - ```stat_summary```é–¢æ•°ã§å¹³å‡å€¤ã‚’è¨ˆç®—ã™ã‚‹

```{r}
mpg %>%
  ggplot(mapping = aes(x = class, y = cty)) +
  stat_summary(geom = "bar", fun = "mean") 
```

  - äº‹å‰ã«å¹³å‡å€¤ã‚’è¨ˆç®—ã—ã¦ãŠãã®ã‚‚ä¸€ã¤ã®ã‚„ã‚Šæ–¹
  
```{r}
mean_mpg <- mpg %>%
  group_by(class) %>%
  summarise(mean_cty = mean(cty))

mean_mpg %>%
  ggplot(aes(x = class, y = mean_cty)) +
  geom_bar(stat = "identity")
```

#### ç®±ã²ã’å›³

```{r}
mpg %>%
  ggplot(mapping = aes(x = class, y = cty)) +
  geom_boxplot()
```

#### ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚„å‘ã

- å›³ã®æ–‡å­—ã‚µã‚¤ã‚ºãªã©ã¯```theme```

- ```size = æ•°å€¤```ã§æŒ‡å®šã€‚å˜ä½ã¯```pt```

- xè»¸ã®å¤‰æ•°åãŒé‡ãªã£ã¦ã‚ˆãè¦‹ãˆãªã„

```{r}
ggplot(mpg, aes(x = class, y = cty, group = class)) +
  geom_boxplot() +
  facet_wrap(~ drv) +  # é§†å‹•æ–¹å¼ã§facetï¼ˆä¾‹: f, r, 4ï¼‰
  labs(title = "City Mileage by Class",
       x = "Car Class",
       y = "City MPG") +
  theme(
    plot.title = element_text(size = 20),        # ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º
    axis.title.x = element_text(size = 10),      # xè»¸ãƒ©ãƒ™ãƒ«
    axis.title.y = element_text(size = 14),      # yè»¸ãƒ©ãƒ™ãƒ«
    axis.text.x = element_text(size = 12),       # xè»¸ç›®ç››
    axis.text.y = element_text(size = 6),       # yè»¸ç›®ç››
    strip.text = element_text(size = 22)         # facetã®ãƒ©ãƒ™ãƒ«ï¼ˆã‚¹ãƒˆãƒªãƒƒãƒ—ï¼‰
  )
```

- æ–‡å­—ã®è§’åº¦ã‚’å¤‰æ›´ã—ã€é‡è¤‡ã™ã‚‹ã®ã‚’é˜²ã

```{r}
ggplot(mpg, aes(x = class, y = cty, group = class)) +
  geom_boxplot() +
  facet_wrap(~ drv) +  # é§†å‹•æ–¹å¼ã§facetï¼ˆä¾‹: f, r, 4ï¼‰
  labs(title = "City Mileage by Class",
       x = "Car Class",
       y = "City MPG") +
  theme(
    plot.title = element_text(size = 20),        
    axis.title.x = element_text(size = 10),      
    axis.title.y = element_text(size = 14),      
    axis.text.x = element_text(size = 10, angle = 45, hjust = 1),  # â˜… ã“ã“ã§å‚¾ã‘ã‚‹
    axis.text.y = element_text(size = 6),       
    strip.text = element_text(size = 22)         
  )
```

- è¡¨ç¤ºã•ã›ãªã„å ´åˆã¯```element_blank()```

  - xè»¸ã®ãƒ¡ãƒ¢ãƒªã‚’éè¡¨ç¤º

```{r}
ggplot(mpg, aes(x = class, y = cty)) +
  geom_boxplot() +
  facet_wrap(~ drv) +
  labs(title = "City Mileage by Class",
       x = "Car Class",
       y = "City MPG") +
  theme(
    plot.title = element_text(size = 20),
    axis.title.x = element_text(size = 14),
    axis.title.y = element_text(size = 14),
    axis.text.x = element_blank(),            # â˜… xè»¸ã®ãƒ¡ãƒ¢ãƒªã‚’éè¡¨ç¤ºã«
    axis.text.y = element_text(size = 10),
    strip.text = element_text(size = 16)
  )
```

#### ```ggplotly```ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªå›³ã‚’ä½œæˆ

- ```ggplot2```ã®å›³ã‚’ä½œæˆã—å¤‰æ•°ã«ä¿å­˜ã—ã€```ggplotly```é–¢æ•°ã§æç”»ã™ã‚‹

- å›³ã®ä¸Šã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’ç½®ã„ã¦ã¿ã¦ãã ã•ã„

```{r}
#install.packages("plotly")
gg_mpg <- mpg %>%
  ggplot(mapping = aes(x = class, y = cty)) +
  geom_boxplot() 

plotly::ggplotly(gg_mpg)
```

## GUIã§ggplotã§ã®ä½œå›³

- ```esquisse```ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨

- ```esquisser(viewer = "browser")```ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãã€GUIã§ä½œå›³ãŒã§ãã‚‹ã€‚ã¾ãŸã€ä½œæˆã—ãŸå›³ã‚’Rã§ä½œæˆã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚‚å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```{markdown}
#install.packages("esquisse")
library(esquisse)
esquisser(viewer = "browser")
```


## æ¬¡é€±ã¾ã§ã®èª²é¡Œ
- **ãªã—**

## å‚è€ƒæ–‡çŒ®

- ğŸ“šæ¾æ‘ãƒ»æ¹¯è°·ãƒ»ç´€ãƒå®šãƒ»å‰ç”°ï¼ˆ2021ï¼‰ã€æ”¹è¨‚2ç‰ˆ Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®RStudio[å®Ÿè·µ]å…¥é–€â€•tidyverseã«ã‚ˆã‚‹ãƒ¢ãƒ€ãƒ³ãªåˆ†æãƒ•ãƒ­ãƒ¼ã®ä¸–ç•Œã€æŠ€è¡“è©•è«–ç¤¾

- ğŸ’»[ç–«å­¦ã®ãŸã‚ã® R ãƒãƒ³ãƒ‰ãƒ–ãƒƒã‚¯ã€€39  å‹•çš„ãªå›³ã®ä½œæˆ](https://epirhandbook.com/jp/new_pages/interactive_plots.jp.html)

- ğŸ’»[Rã§è§£æï¼šGUIæ“ä½œã§ggplot2ï¼ï¼ã€Œesquisseã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://www.karada-good.net/analyticsr/r-808/)

```{=html}
<style>
.infobox {
  padding: 1em 1em 1em 4em;
  margin-bottom: 10px;
  border: 2px solid orange;
  border-radius: 10px;
  background: #f5f5f5 5px center/3em no-repeat;
}

.beg {
  background-image: url("https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjHtu3kBX8P39WYBBAjar9c8c1ladK2SYL6_gEMXFweQfauWVhSvCQP5KELsPX5KNL1uOddLLQ-aeMxv904OW_NFFfANhBYObfBV09KO2EXehrb9kMdCLZY1afsChib-7zIkBJbG6OrbJpM/s400/aisatsu_kodomo_boy.png");}

.caution {
  background-image: url("https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzMqkpQ7vLUKvumbm6AFwTLQiCe7tlDb2Q0MAiISLsesZHnhj0kbRjB4U3se3UrDIHfIy0hlahyphenhyphenQu-V2tOR2LcV_lX7U8P5a8jtqPYv3Ah4L-JoYi8PhoaoehumGIdp2vrsX0rRyhXqwA/s800/mark_chuui.png");}
  
</style>
```