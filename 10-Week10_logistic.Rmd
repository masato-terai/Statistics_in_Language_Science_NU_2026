# Week10: ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«ï¼šãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°åˆ†æ

```{r, include=FALSE}
library(rstan)
library(brms)
library(gt)
library(tidyverse)
library(kableExtra)

rstan_options(auto_write = T)
options(mc.cores = parallel::detectCores())
```

## äº‹å‰ã®ç¢ºèª

- ã“ã®è¬›ç¾©ã®Rãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã„ã¦ã„ã¾ã™ã‹ï¼Ÿ
- è‹±æ•°å­—ã§åå‰ã‚’ä»˜ã‘ãŸæœ¬æ—¥ã®è¬›ç¾©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã‹ï¼Ÿ

  - .Rã§ã‚‚.Rmdã§ã‚‚ã©ã¡ã‚‰ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

## ä»Šæ—¥ã®ç›®æ¨™

1. ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ã‚¯å›å¸°åˆ†æã‚’æ•°å­¦çš„ãƒ»æ¦‚å¿µçš„ã«ç†è§£ã§ãã‚‹
2. ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ã‚¯å›å¸°åˆ†æã‚’Rã§å®Ÿè£…ã—ã€ãã®çµæœã‚’èª¬æ˜ã§ãã‚‹

## ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«
- ç¢ºç‡åˆ†å¸ƒã«æ­£è¦åˆ†å¸ƒä»¥å¤–ã‚’ä»®å®šã™ã‚‹ï¼ˆä¸€èˆ¬ç·šå½¢ãƒ¢ãƒ‡ãƒ« = æ­£è¦åˆ†å¸ƒã‚’ä»®å®šï¼‰

  - ä¸–ã®ä¸­ã«ã¯ã€æ­£è¦åˆ†å¸ƒã§è¡¨ç¾ã™ã‚‹ã®ãŒé›£ã—ã„äº‹è±¡ãŒã‚ã‚‹
  
    - ãƒ†ã‚¹ãƒˆã¸ã®åˆæ ¼/ä¸åˆæ ¼
    
    - æ‰€å¾—ã®åˆ†å¸ƒ
    
    - ä¿¡é ¼ã§ãã‚‹å‹é”ã®æ•°

- ```glm()```é–¢æ•°ã§ä½¿ç”¨ã§ãã‚‹åˆ†å¸ƒ

  - å¤–å›½èªç ”ç©¶ã€è¨€èªç ”ç©¶ã§ã¯ã€æ­£è¦åˆ†å¸ƒã€äºŒé …åˆ†å¸ƒã€å¯¾æ•°æ­£è¦åˆ†å¸ƒãªã©ãŒç”¨ã„ã‚‰ã‚Œã‚‹

```{markdown}
binomial(link = "logit")
gaussian(link = "identity")
Gamma(link = "inverse")
inverse.gaussian(link = "1/mu^2")
poisson(link = "log")
quasi(link = "identity", variance = "constant")
quasibinomial(link = "logit")
quasipoisson(link = "log")
```

::: infobox
ä½¿ç”¨ã™ã‚‹Rã®é–¢æ•°ã«ã‚ˆã£ã¦ã€ä½¿ç”¨ã§ãã‚‹ç¢ºç‡åˆ†å¸ƒãŒç•°ãªã‚Šã¾ã™ã€‚```glm```é–¢æ•°ã«ã¯å¯¾æ•°æ­£è¦åˆ†å¸ƒã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
:::

## äºŒé …åˆ†å¸ƒ
- ã‚ã‚‹è©¦è¡Œã‚’ *N* å›è¡Œã£ãŸéš›ã®æˆåŠŸå›æ•° *k* ãŒç™ºç”Ÿã™ã‚‹ç¢ºç‡ *q*

\[
p(k \mid N, q) = \binom{N}{k} q^k (1 - q)^{N - k}
\]

\[
\binom{N}{k} = \frac{N!}{k!(N-k)!}
\]

### èº«è¿‘ãªä¾‹

  - å¯ºäº•ã¨é›…äººãŒã˜ã‚ƒã‚“ã‘ã‚“ã‚’10å›ã™ã‚‹ã€‚å¯ºäº•ãŒé›…äººã« *K* å›å‹ã¤ç¢ºç‡ã‚’æ±‚ã‚ã‚‹ï¼ˆå‹ã¤å¯èƒ½æ€§ã¯50 %ï¼‰

  - å¯ºäº•ãŒ2å›å‹ã¤å ´åˆ (\( k = 2 \))

\[
P(X = 2) = \binom{10}{2} (0.5)^2 (0.5)^{10-2} = \binom{10}{2} (0.5)^{10}
\]

ã“ã“ã§ã€äºŒé …ä¿‚æ•°ã¯æ¬¡ã®ã‚ˆã†ã«è¨ˆç®—ï¼ˆ8!ã‚’ã¾ã¨ã‚ã¦æ¶ˆã—ã¦ã„ã‚‹ï¼‰ï¼š

\[
\binom{10}{2} = \frac{10 \times 9}{2 \times 1} = 45
\]

ã—ãŸãŒã£ã¦ã€ç¢ºç‡ã¯ï¼š

\[
P(X = 2) = 45 \times (0.5)^{10} = 45 \times \frac{1}{1024} \approx 0.043945
\]

2å›å‹ã¤ç¢ºç‡ã¯ç´„ **0.0439** 

  - å¯ºäº•ãŒ4å›å‹ã¤å ´åˆ (\( k = 4 \))

\[
P(X = 4) = \binom{10}{4} (0.5)^4 (0.5)^{10-4} = \binom{10}{4} (0.5)^{10}
\]


\[
\binom{10}{4} = \frac{10 \times 9 \times 8 \times 7}{4 \times 3 \times 2 \times 1} = 210
\]

ã—ãŸãŒã£ã¦ã€ç¢ºç‡ã¯ï¼š

\[
P(X = 4) = 210 \times (0.5)^{10} = 210 \times \frac{1}{1024} \approx 0.205078
\]

  - 4å›å‹ã¤ç¢ºç‡ã¯ç´„ **0.2051**

```{r}
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
N <- 10  # è©¦è¡Œå›æ•°
k <- 4   # æˆåŠŸå›æ•°
p <- 0.5  # æˆåŠŸç¢ºç‡ï¼ˆä¾‹ãˆã°ã€50%ã®ç¢ºç‡ï¼‰

# 2é …åˆ†å¸ƒã«ãŠã‘ã‚‹ç¢ºç‡ã‚’è¨ˆç®—
prob <- dbinom(k, size = N, prob = p)
print(prob)
```

- ç·šå½¢å›å¸°ã‚’2å€¤ã®ãƒ‡ãƒ¼ã‚¿ã«å½“ã¦ã¯ã‚ãŸãƒ¢ãƒ‡ãƒ«ã¯ã€äºˆæ¸¬å€¤ï¼ˆç›´ç·šï¼‰ãŒ1ä»¥ä¸Šã§ã‚ã£ãŸã‚Š0ä»¥ä¸‹ã§ã‚ã£ãŸã‚Šã—ã¦ã„ã‚‹ï¼ˆæœ¬æ¥ã¯1 = åˆæ ¼ã€0 = ä¸åˆæ ¼ï¼‰

  - äºˆæ¸¬å€¤ã‚’0ã‹ã‚‰1ã«åã¾ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã“ã‚Œã‚’è¡Œã†ãŸã‚ã®é–¢æ•°ãŒãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°

```{r, echo=FALSE, message=FALSE, warning=FALSE}
set.seed(123)
dat <- data.frame(
  Years_of_Study = runif(100, 0, 10)  # 0ã€œ10å¹´ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå­¦ç¿’å¹´æ•°
)
dat$Pass <- rbinom(100, 1, prob = plogis(0.8 * dat$Years_of_Study - 4)) # æ­£è§£ç‡ã®ç¢ºç‡çš„ãƒ‡ãƒ¼ã‚¿

# **1. ãã®ã¾ã¾ç·šå½¢å›å¸°**
p1 <- ggplot(dat, aes(x = Years_of_Study, y = Pass)) +
  geom_point(alpha = 0.6) +  
  geom_smooth(method = "lm", se = FALSE, color = "red") +  
  labs(title = "1) äºŒå€¤ãƒ‡ãƒ¼ã‚¿ã«ç·šå½¢å›å¸°",
       x = "Years of Study", y = "Pass (0 or 1)") +
  ylim(0,1)

p1
```

- åˆ‡ç‰‡ã®å€¤ã¯ãƒã‚¤ãƒŠã‚¹ã¨ãªã£ã¦ãŠã‚Šã€0-1ã¨ã„ã†ç¢ºç‡ã®ç¯„å›²ã‚’è¶…ãˆã¦ã„ã‚‹ã€‚
```{r}
res <- lm(Pass ~ Years_of_Study, data = dat)
sjPlot::tab_model(res)
```

### äºŒé …åˆ†å¸ƒã‹ã‚‰ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ãƒ¢ãƒ‡ãƒ«ã¸
- äºŒé …åˆ†å¸ƒã¯æˆåŠŸå›æ•°ã®ç¢ºç‡åˆ†å¸ƒã‚’è¡¨ã™ã€‚ã“ã®æˆåŠŸå›æ•°ã‚’äºˆæ¸¬ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ãŒ**ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ãƒ¢ãƒ‡ãƒ«**

## ãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°
- 0ã‹1ã—ã‹ã¨ã‚‰ãªã„å¾“å±å¤‰æ•°ãŒ1ã«ãªã‚‹ç¢ºç‡ï¼ˆç¢ºç‡ã¯0ã¨1ã§ã¯ãªãã€0ã‹ã‚‰1ã®é–“ã‚’ã¨ã‚‹ï¼‰ã‚’ *P* ã¨ã™ã‚‹ã¨ã€0ã«ãªã‚‹ç¢ºç‡ã¯ 1 - *P*ã€‚ã“ã®äºŒã¤ã®æ¯”ã‚’**ã‚ªãƒƒã‚ºæ¯”**ã¨ã„ã†ã€‚


\[
\text{odds ratio} = \frac{P}{1 - P}
\]

- ç¢ºç‡ï¼ˆ *P* ï¼‰ã‚’å¯¾æ•°ã‚ªãƒƒã‚ºã«å¤‰æ›ï¼ˆãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›ã¨ã„ã†ï¼‰
  
  - å¯¾æ•°ã‚ªãƒƒã‚ºã®ã“ã¨ã‚’ãƒ­ã‚¸ãƒƒãƒˆã¨ã„ã†
  
  - 0ã‹ã‚‰1ã—ã‹ã¨ã‚‰ãªã„å€¤ã‚’ã€-âˆ ~ âˆã‚’å–ã‚‹é€£ç¶šå€¤ã®ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹é–¢æ•°ãŒãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°

\[
\text{logit}(P) = \log \left( \frac{P}{1 - P} \right)
\]

- ãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°ã«ã‚ˆã‚Šã€

  - ã“ã®å¤‰æ›ã§ã€å¾“å±å¤‰æ•°ã®å€¤ãŒ0ã‹1ã‹ã¨ã„ã†åˆ¶ç´„ãŒãªããªã‚Šã€ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦åå›å¸°ä¿‚æ•°ã‚’æ¨å®šã§ãã‚‹
    
    - ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã§å½“ã¦ã¯ã‚ã‚‹æ–¹ãŒè¨ˆç®—ãªã©ã®éƒ½åˆãŒã„ã„ã‹ã‚‰

- **ç·š**å½¢ãƒ¢ãƒ‡ãƒ«ã¨ã¯ç•°ãªã‚Šã€**æ›²ç·š**ã§ã‚ã‚‹ãŸã‚ã€1å˜ä½ã®å¤‰åŒ–é‡ãŒç•°ãªã‚‹

  - logit(0.5) = 0ã€logit(0.6) = 0.4 => ãƒ­ã‚¸ãƒƒãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã§ã®0.4ã®å¤‰æ›ã¯å¤‰æ›å‰ã®å˜ä½ã§ã®50%ã‹ã‚‰60%ã®å¤‰æ›´ã«å¯¾å¿œ
  
  - logit(0.9) = 2.2ã€logit(0.93) = 2.6 => ãƒ­ã‚¸ãƒƒãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã§ã®0.4ã®å¤‰æ›ã¯å¤‰æ›å‰ã®å˜ä½ã§ã®90%ã‹ã‚‰93%ã®å¤‰æ›´ã«å¯¾å¿œ

```{r, echo=FALSE, warning=FALSE}
# 0ã‹ã‚‰1ã®å€¤ã‚’ç­‰é–“éš”ã§ç”Ÿæˆï¼ˆãŸã ã—0ã¨1ã¯é™¤ãï¼‰
p_values <- seq(0.001, 0.999, length.out = 100)

# ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›
logit_values <- log(p_values / (1 - p_values))

# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ
logit_data <- data.frame(
  Before_Logit = p_values,  # å¤‰æ›å‰ã®å€¤ (0ã€œ1)
  After_Logit = logit_values # å¤‰æ›å¾Œã®å€¤
)

# ã‚°ãƒ©ãƒ•æç”»
ggplot(logit_data, aes(x = Before_Logit, y = After_Logit)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›ã®å¯è¦–åŒ–",
       x = "ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›å‰ (0ã‹ã‚‰1ã®å€¤)",
       y = "ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›å¾Œ")
```

## ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°
- ã“ã®é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€èª¬æ˜å¤‰æ•°ã®é›†ã¾ã‚Šï¼ˆç·šå½¢äºˆæ¸¬å­ï¼šç·šå½¢çµåˆã—ãŸèª¬æ˜å¤‰æ•°ï¼‰ãŒã©ã®ç¯„å›²ã«åˆã£ã¦ã‚‚ã€0 ~ 1ã®ç¯„å›²ã«åã¾ã‚‹ï¼ˆç¢ºç‡ã‚’è¡¨ã™ã®ã«æœ€é©ï¼ï¼‰ã€‚

  - ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ã§ã¯ãƒªãƒ³ã‚¯é–¢æ•°ã«ãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°ã‚’ãŠãã€ç¢ºç‡ã‚’ç·šå½¢äºˆæ¸¬å­ã«å¤‰æ›

  - ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã¯é€†ãƒªãƒ³ã‚¯é–¢æ•°ã¨ã—ã¦ä½¿ã‚ã‚Œã€ç·šå½¢äºˆæ¸¬å­ã‹ã‚‰ç¢ºç‡ã‚’å¾©å…ƒã™ã‚‹
  
    - ãƒªãƒ³ã‚¯é–¢æ•°ï¼šå¾“å±å¤‰æ•°ã‚’å¤‰æ›ã—ã€ç‹¬ç«‹å¤‰æ•°é–¢æ•°ã«ã¤ãªã’ã‚‹å¤‰æ›é–¢æ•°ã€ç‹¬ç«‹å¤‰æ•°ã‚’å¤‰æ›ã™ã‚‹å ´åˆã¯ã€Œé€†ã€ãƒªãƒ³ã‚¯é–¢æ•°


\[
\text{logistic}(x) = \frac{1}{1 + e^{-x}}
\]


```{r, echo=FALSE}
# ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã®å®šç¾©
logistic <- function(x) {
  1 / (1 + exp(-x))
}

# x ã®ç¯„å›²ã‚’è¨­å®šã—ã€å¯¾å¿œã™ã‚‹ y ã‚’è¨ˆç®—
df <- data.frame(x = seq(-6, 6, length.out = 100))
df$y <- logistic(df$x)

# ggplot ã§æç”»
ggplot(df, aes(x = x, y = y)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°",
       x = "x",
       y = "Ïƒ(x) = 1 / (1 + exp(-x))")

```


### ã¤ã¾ã‚Š
1. ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã‚„ã™ã„ã‚ˆã†ã«ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›ã‚’ã—ã¦ç·šå½¢å›å¸°ã‚’è¡Œã†ã€‚

2. å€¤ã‚’ã‚‚ã¨ã«æˆ»ã•ãªã„ã¨ç†è§£ã—ãšã‚‰ã„ãŸã‚ã€ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã‚’ä½¿ã£ã¦0 ~ 1ã®ç¯„å›²ã«æˆ»ã—ã¦ã„ã‚‹

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# **2. ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›**
dat <- dat %>% 
  mutate(Logit_Pass = log((Pass + 0.01) / (1 - Pass + 0.01)))  # ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›

# **ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›å¾Œã®ç·šå½¢å›å¸°**
p2 <- ggplot(dat, aes(x = Years_of_Study, y = Logit_Pass)) +
  geom_point(alpha = 0.6) +  
  geom_smooth(method = "lm", se = FALSE, color = "green") +  
  labs(title = "2) ãƒ­ã‚¸ãƒƒãƒˆå¤‰æ›å¾Œã«ç·šå½¢å›å¸°",
       x = "Years of Study", y = "Logit(Pass)")

# **3. ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ï¼ˆå…ƒã®ç¢ºç‡ã«æˆ»ã™ï¼‰**
p3 <- ggplot(dat, aes(x = Years_of_Study, y = Pass)) +
  geom_point(alpha = 0.6) +  
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, color = "blue") +  
  labs(title = "3) ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ï¼ˆæ›²ç·šï¼‰",
       x = "Years of Study", y = "Probability of Passing (0 to 1)")

gridExtra::grid.arrange(p1, p2, ncol = 2)
gridExtra::grid.arrange(p2, p3, ncol = 2)
```


::: infobox
ä¸€èˆ¬ã€ŒåŒ–ã€ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã§ã¯ã€ã©ã®ç¢ºç‡åˆ†å¸ƒã‚’ä½¿ã†ã‹ã ã‘ã§ãªãã€ã©ã®ã‚ˆã†ãªå¤‰æ›é–¢æ•°ã§å¤‰æ›ã‚’ã™ã‚‹ã‹ã‚‚æŠŠæ¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ãã®ãŸã‚ã€ä½•ã§ã‚‚ã‹ã‚“ã§ã‚‚æ­£è¦åˆ†å¸ƒã§åˆ†æã—ãŸã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’ç„¡ç†ã‚„ã‚Šå¤‰æ›ã—æ­£è¦åˆ†å¸ƒã«è¿‘ã¥ã‘ã‚‹ã‚ˆã†ãªæ–¹æ³•ã§ã¯ãªãã€å¾—ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ã«ã€ãƒ¢ãƒ‡ãƒ«ã®å·¥å¤«ã§ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ã™ã‚‹ã¨ã„ã†è€ƒãˆæ–¹ãŒèº«ã«ã¤ãã€‚
:::

### ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã®ä½¿ç”¨ä¸Šã®æ³¨æ„

- ä¸€èˆ¬ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã®ã‚ˆã†ã«ã€å›å¸°ä¿‚æ•°ã‚’ãã®ã¾ã¾è§£é‡ˆã§ããªã„

  - å¤‰æ›ä¿‚æ•°ã‚’çµŒç”±ã—ã¦ã€èª¬æ˜å¤‰æ•°ã®å¤‰åŒ–ãŒå½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹
  
    - å›å¸°åˆ†æï¼šã‚ã‚‹ç‹¬ç«‹å¤‰æ•°AãŒ1å˜ä½å¤‰åŒ–ã™ã‚‹ã¨ã€å¾“å±å¤‰æ•°ã¯Bã ã‘å¤‰åŒ–
    
    - ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ï¼šã‚ã‚‹ç‹¬ç«‹å¤‰æ•°AãŒ1å˜ä½å¤‰åŒ–ã™ã‚‹ã¨ã€å¾“å±å¤‰æ•°ã¯exp(B)ã ã‘å¤‰åŒ–

- ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã¯ãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°ã®é€†é–¢æ•°ã®ã“ã¨

  - é€†é–¢æ•°ï¼šæˆ»ã—ã¦ã‚ã’ã‚‹é–¢æ•°ã®ã“ã¨
  
    - e.g., log(3) -> exp(log(3)) = 3
    
  - ãƒªãƒ³ã‚¯é–¢æ•°ã¨ã—ã¦ãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°ã‚’ä½¿ã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ­ã‚¸ãƒƒãƒˆé–¢æ•°ã®é€†é–¢æ•°ã§ã‚ã‚‹ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã§æˆ»ã—ã¦ã‚ã’ã¦ã„ã‚‹ã€‚
  

## ãƒãƒ³ã‚ºã‚ªãƒ³ã‚»ãƒƒã‚·ãƒ§ãƒ³
### ç–‘ä¼¼ãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„
- Passï¼š ãƒ†ã‚¹ãƒˆã®åˆå¦ã€‚1ãªã‚‰åˆæ ¼ã€0ãªã‚‰ä¸åˆæ ¼

- Methodï¼šæŒ‡å°æ³•Aã€æŒ‡å°æ³•B

- Starting_ageï¼šè‹±èªã‚’å‹‰å¼·ã—å§‹ã‚ãŸå¹´é½¢

```{r}
set.seed(123)  # å†ç¾æ€§ã®ãŸã‚

dat <- data.frame(
  Pass = sample(0:1, 40, replace = TRUE),  # 1 ã¾ãŸã¯ 0
  Method = sample(c("A", "B"), 40, replace = TRUE),  # A ã¾ãŸã¯ B
  Starting_age = sample(0:10, 40, replace = TRUE)  # 0 ~ 10 ã®æ•°å€¤
)
```

```{r}
head(dat, head = 3)
```

```{r}
summary(dat)
```

### ãƒ¢ãƒ‡ãƒ«ã®æ¨å®š
- ```glm()```é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹

  - ```family```ã§ç¢ºç‡åˆ†å¸ƒã‚’æŒ‡å®šã™ã‚‹

```{r}
library(stats)

res <- glm(
  Pass ~ Starting_age,
  family = binomial(link = "logit"),
  data = dat
)
```

- Estimate: åå›å¸°ä¿‚æ•°

- Std. Error (Standard Error): æ¨™æº–èª¤å·®

  - ã‹ãªã‚Šé‡è¦ã€‚ã©ã‚Œãã‚‰ã„æ¨å®šã«èª¤å·®ãŒã‚ã‚‹ã‹ã‚’ç¤ºã™æŒ‡æ¨™ã€‚ã€ŒåŒã˜èª¿æŸ»æ³•ã§åŒã˜æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¨ã‚ŠãªãŠã—ã¦ã¿ã‚‹ã¨ã€æ¨å®šå€¤ã‚‚çµæ§‹å¤‰ã‚ã‚‹ã®ã§ã€ãã®ãƒãƒ©ãƒ„ã‚­åº¦åˆã„ã€

- *z* valueï¼šzå€¤ã¨å‘¼ã°ã‚Œã‚‹çµ±è¨ˆé‡ï¼ˆWaldçµ±è¨ˆé‡ã¨ã‚‚è¨€ã‚ã‚Œã‚‹ï¼‰ã€‚Estimate Ã· SE ã§ç®—å‡ºã€‚ã“ã®å€¤ã§ã€Waldä¿¡é ¼åŒºé–“ã‚’ç®—å‡ºã—ã€ãã®å€¤ãŒã‚¼ãƒ­ã‹ã‚‰ååˆ†ã«é›¢ã‚Œã¦ã„ã‚‹ã‹ã®ç›®å®‰ã«ãªã‚‹ã€‚

- Pr(>|z|): å¹³å‡ãŒ zå€¤ã®çµ¶å¯¾å€¤ã§ã€æ¨™æº–åå·®ãŒ1ã®æ­£è¦åˆ†å¸ƒã«ãŠã„ã¦ã€ãƒã‚¤ãƒŠã‚¹ç„¡é™å¤§ã‹ã‚‰ã‚¼ãƒ­ã¾ã§ã®å€¤ã‚’ã¨ã‚‹ç¢ºç‡ã€‚ã“ã®ç¢ºç‡ãŒå¤§ãã„ã»ã©Zå€¤ãŒã‚¼ãƒ­ã«è¿‘ããªã‚Šã€EstimateãŒã‚¼ãƒ­ã«è¿‘ã„ã€‚

- *p* å€¤ï¼ˆã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ï¼‰ï¼š95%ä¿¡é ¼åŒºé–“ï¼ˆCIï¼‰ã«0ã‚’å«ã¾ãªã„å ´åˆã€æœ‰æ„ã¨ã•ã‚Œã‚‹

```{r}
summary(res)
```

- 95%ä¿¡é ¼åŒºé–“ã®ç®—å‡º
```{r, message=FALSE}
stats::confint(res)
```

### ä½œå›³

```{r}
# å¹´é½¢ï¼ˆYears_of_Studyï¼‰ã®ç¯„å›²ã‚’è¨­å®š
years_range <- seq(0, 10, length.out = 100)

# å„å¹´æ•°ã«å¯¾ã™ã‚‹äºˆæ¸¬ç¢ºç‡ã‚’è¨ˆç®—
pred_probs <- predict(res, newdata = data.frame(Starting_age = years_range), type = "response")

# äºˆæ¸¬ç¢ºç‡ã‚’æç”»
plot(
  years_range, pred_probs, 
  type = "l",  # ç·šã§æç”»
  col = "blue", 
  lwd = 2, 
  xlab = "Starting Age", 
  ylab = "Pr (Pass)", 
  main = "Logistic Regression: Probability of Passing",
  ylim = c(0, 1),
  xaxt = "n", yaxs = "i"
)

# xè»¸ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
axis(1, at = seq(0, 10, by = 1), labels = seq(0, 10, by = 1))
```

### ã‚ªãƒƒã‚ºæ¯”ã®ç®—å‡º
- ã‚ªãƒƒã‚ºæ¯”ï¼šã‚ªãƒƒã‚ºã®å¤‰åŒ–é‡ã€‚ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ãƒ¢ãƒ‡ãƒ«ã®å›å¸°ä¿‚æ•°ã«æŒ‡æ•°é–¢æ•°ã‚’é©ç”¨ã™ã‚‹ã¨ç®—å‡ºã§ãã‚‹ã€‚

  - æŒ‡æ•°é–¢æ•°ã‚’ã¨ã‚‹ã¨ã€ãã®å€¤ã¯å¿…ãšæ­£ã®å€¤ã«ãªã‚‹
  
```{r, echo=FALSE}
# ãƒ‡ãƒ¼ã‚¿ä½œæˆ
data <- data.frame(
  `Estimate` = c("æ­£ï¼ˆ> 0ï¼‰", "0", "è² ï¼ˆ< 0ï¼‰"),
  `ã‚ªãƒƒã‚ºæ¯”` = c("> 1", "= 1", "< 1"),
  `è§£é‡ˆ` = c("ã‚ªãƒƒã‚ºãŒ å¢—åŠ ",
             "ã‚ªãƒƒã‚ºã¯ å¤‰åŒ–ãªã—",
             "ã‚ªãƒƒã‚ºãŒ æ¸›å°‘")
)

kable(data, booktabs = TRUE, escape = FALSE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

- ä¿‚æ•°ãŒãƒã‚¤ãƒŠã‚¹ã ã£ãŸã®ã§ã€ ã‚ªãƒƒã‚ºæ¯” < 1ã¨ãªã£ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„
```{r}
exp(res$coefficients)
```

```{r, message=FALSE}
exp(stats::confint(res))
```

### çµæœå ±å‘Šã®ä¾‹ã¨è§£é‡ˆ
- è‹±èªã®å­¦ç¿’å¹´æ•°ã®ä¸»åŠ¹æœã®ä¿‚æ•°ã¯æœ‰æ„ã§ã¯ãªã‹ã£ãŸï¼ˆ*Estimate* = -0.21 [-0.47, 0.03], *SE* = 0.12, *z* = -1.67, *p* = .10, *OR* = 0.81 [0.63, 1.03]ï¼‰ã€‚å‚¾å‘ã¨ã—ã¦ã€è‹±èªå­¦ç¿’é–‹å§‹æ­´ãŒ1å¹´å¢—ãˆã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã™ã‚‹**ã‚ªãƒƒã‚º**ãŒ0.81å€ã«ãªã‚‹ï¼ˆ = åˆæ ¼ã™ã‚‹ã‚ªãƒƒã‚ºãŒ [1 - 0.81 = 19] 19%ä½ã„ï¼‰ã¨äºˆæ¸¬ã•ã‚Œã‚‹ã€‚

- ã‚‚ã—ä¿‚æ•°ãŒ0.21ã ã£ãŸå ´åˆã€ã‚ªãƒƒã‚ºæ¯”ã¯```exp(0.21) = 1.23```ã€‚ã“ã®å ´åˆã€

  - è‹±èªå­¦ç¿’æ­´ãŒ1å¹´å¢—ãˆã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã™ã‚‹**ã‚ªãƒƒã‚ºãŒ1.23å€ã«ãªã‚‹ã€‚ã¤ã¾ã‚Šã€ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã™ã‚‹ã‚ªãƒƒã‚ºã¯ï¼ˆä¸åˆæ ¼ã¨ãªã‚‹å ´åˆã«æ¯”ã¹ï¼‰ï¼ˆ1.23 - 1 = 0.23ï¼‰23%å¢—åŠ ã™ã‚‹ã¨äºˆæ¸¬ã•ã‚Œã‚‹ã€‚

- ã—ã‹ã—ã€ã‚ªãƒƒã‚ºã‚„ã‚ªãƒƒã‚ºæ¯”ã§çµæœã‚’è¨€ã‚ã‚Œã¦ã‚‚è§£é‡ˆãŒå°‘ã—é›£ã—ã„ã€‚```predict```é–¢æ•°ã§å…·ä½“çš„ãªåˆæ ¼ã™ã‚‹ç¢ºç‡ã‚’ç®—å‡ºã™ã‚‹æ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã€‚

```{r}
# å¹´é½¢ï¼ˆYears_of_Studyï¼‰ã®ç¯„å›²ã‚’è¨­å®š
years_range <- seq(0, 10)

# å„å¹´æ•°ã«å¯¾ã™ã‚‹äºˆæ¸¬ç¢ºç‡ã‚’è¨ˆç®—
pred_probs <- predict(res, newdata = data.frame(Starting_age = years_range), type = "response")
```

- 100ã‚’æ›¸ã‘ã¦%å˜ä½ã«å¤‰æ›
```{r}
pred_probs * 100
```

- ä½œå›³
```{r}
plot(pred_probs * 100)
```


### æ–°ãŸãªãƒ‡ãƒ¼ã‚¿ã§äºˆæ¸¬ã—ã¦ã¿ã‚‹
- 25æ­³ã§åˆã‚ã¦å ´åˆã‚’èª¿ã¹ã¦ã¿ã‚‹
- ```type = "link"```ã«ã™ã‚‹ã¨ã€ä¿‚æ•°ãŒå¾—ã‚‰ã‚Œã‚‹
```{r}
new <- data.frame(Starting_age = 25)
pred_probs <- predict(res, newdata = new, type = "link")
```
- ã‚ªãƒƒã‚ºæ¯”ã‚’è¨ˆç®—
```{r}
exp(pred_probs)
```

- ```type = "response"```ã«ã™ã‚‹ã¨ã€äºˆæ¸¬ç¢ºç‡ãŒè¿”ã•ã‚Œã‚‹
```{r}
pred_probs <- predict(res, newdata = new, type = "response")
```

- 25æ­³ã§ã¯ã˜ã‚ã‚‹ã¨ã€1.13 %ã®åˆæ ¼ç¢ºç‡ã¨ãªã‚‹
```{r}
pred_probs * 100
```

## è³ªçš„å¤‰æ•°ã®å ´åˆ

```{r}
means <- aggregate(Pass ~ Method, data = dat, FUN = mean)
means
```


```{r}
table(dat$Method)
```

```{r}
# Methodã”ã¨ã®æ­£ç­”ç‡ã‚’è¨ˆç®—
table_data <- table(dat$Method, dat$Pass)

# æ£’ã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–
barplot(prop.table(table_data, margin = 1), beside = TRUE,
        legend = rownames(table_data), xlab = "Pass (0 = Incorrect, 1 = Correct)",
        ylab = "Proportion", main = "Proportion of Passing by Method")
```

### ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ

```{r}
dat$Method <- factor(dat$Method)

contrasts(dat$Method)
```

```{r}
res.2 <- glm(
  Pass ~ Method,
  family = binomial(link = "logit"),
  data = dat
)
```

- Method Bã®ä¿‚æ•°ï¼šMethod B - Method A
```{r}
summary(res.2)
```

- 95%ä¿¡é ¼åŒºé–“ã®ç®—å‡º
```{r}
stats::confint(res.2)
```

### ã‚ªãƒƒã‚ºæ¯”
- Methodã®ã‚ªãƒƒã‚ºæ¯”ã¯0.54ã ã£ãŸã€‚ã‚ˆã£ã¦Method Bã¯Aã«æ¯”ã¹ã€åˆæ ¼ã®æˆåŠŸã‚ªãƒƒã‚ºãŒ(1 - 0.54 = 0.46) 46%ä½ã„

```{r}
exp(res.2$coefficients)
```

```{r}
exp(stats::confint(res.2))
```

### ç¢ºç‡ã‚’è¨ˆç®—

```{r}
# glmãƒ¢ãƒ‡ãƒ«ã®çµæœã‚’ä½¿ã£ã¦äºˆæ¸¬ç¢ºç‡ã‚’è¨ˆç®—
pred_probs_A <- predict(res.2, newdata = data.frame(Method = "A"), type = "response")
pred_probs_B <- predict(res.2, newdata = data.frame(Method = "B"), type = "response")
```

```{r}
pred_probs_A
pred_probs_B
```


### ä½œå›³

```{r, message=FALSE,warning=FALSE}
#install.packages("arm")
library(arm)

# Method A ã¨ Method B ã®äºˆæ¸¬ç¢ºç‡ã‚’æç”»
plot(
  c(1, 2), c(pred_probs_A, pred_probs_B), 
  pch = 16, col = "black", cex = 2, 
  xlim = c(0, 3), 
  ylim = c(0, 1), 
  xaxt = "n", xlab = "Method", ylab = "Pr (Pass)",
  xaxs = "i", yaxs = "i"
)

# ä¿¡é ¼åŒºé–“ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ¼ã‚’è¿½åŠ 
arrows(1, pred_probs_A - 0.1, 1, pred_probs_A + 0.1, angle = 90, code = 3, length = 0.1, col = "black")
arrows(2, pred_probs_B - 0.1, 2, pred_probs_B + 0.1, angle = 90, code = 3, length = 0.1, col = "black")

# xè»¸ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ  (Method A ã¨ Method B)
axis(1, at = c(1, 2), labels = c("Method A", "Method B"))

```

## åˆ†é¡ã«ã‚‚ä½¿ãˆã¾ã™

- æ©Ÿæ¢°å­¦ç¿’ãªã©ã§ã¯åˆ†é¡ãƒ¢ãƒ‡ãƒ«ï¼ˆ2ã¤ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã¨ã—ã¦ç”¨ã„ã‚‰ã‚ŒãŸã‚Šã—ã¾ã™ã€‚

  - ä»¥ä¸‹ã§ã¯ã€åˆæ ¼ã®äºˆæ¸¬ç¢ºç‡ãŒ0.6æœªæº€ã®å ´åˆã‚„ã°ã„ï¼ˆ0ï¼‰ã€0.6ä»¥ä¸Šã®å ´åˆå®‰å¿ƒï¼ˆ1ï¼‰ã¨åˆ†é¡ã—ã¦ã„ã¾ã™

```{r}
pred_probs <- predict(res, type = "response", newdata = data.frame(Starting_age = dat$Starting_age))

# äºˆæ¸¬ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
pred_class <- ifelse(pred_probs > 0.6, 1, 0)

# å…ƒã®ãƒ‡ãƒ¼ã‚¿ã«äºˆæ¸¬ç¢ºç‡ã¨äºˆæ¸¬ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
library(tidyverse)
new_data <- dat %>%
  mutate(pred_probs = pred_probs,
         pred_class = pred_class)

# ggplotã§è¦–è¦šåŒ–
ggplot(new_data, aes(x = Starting_age, y = 1, fill = factor(pred_class))) +
  geom_tile(height = 1, width = 1) +  # çŸ©å½¢ã®ã‚µã‚¤ã‚ºèª¿æ•´
  scale_fill_manual(values = c("darkblue", "skyblue")) +  
  labs(x = "Starting Age", y = "", fill = "Predicted Class") +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())
```


## æ¬¡é€±ã¾ã§ã®èª²é¡Œ
### èª²é¡Œå†…å®¹

1. å°ãƒ†ã‚¹ãƒˆã«å‘ã‘ã¦ä»Šå›ã®å†…å®¹ã‚’å¾©ç¿’ã™ã‚‹ã€‚å¿…ãšæ‰‹ã§ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦Rã‚’å®Ÿè¡Œã™ã‚‹ã€‚

2. sample_dataãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹```pokemon_data_logistic.csv```ã‚’ã‚‚ã¨ã«ã€ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°åˆ†æã‚’è¡Œã„ã€ãƒ¢ãƒ‡ãƒ«ã®å›³ç¤ºã‚„çµæœã®å ±å‘Šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

  - å¾“å±å¤‰æ•°ã¯ã€Œé€²åŒ–ã€ã«ã—ã¦ãã ã•ã„ã€‚

### æå‡ºæ–¹æ³•
- TACTä¸Šã§æå‡ºã€‚
- ç· ã‚åˆ‡ã‚Šã¯ä»Šé€±ã®æœ¨æ›œæ—¥ã¾ã§

## å‚è€ƒæ–‡çŒ®

- ğŸ“šå°æ‰ã€è¨€è‘‰ã¨æ•°å¼ã§ç†è§£ã™ã‚‹å¤šå¤‰é‡è§£æå…¥é–€ã€åŒ—å¤§è·¯æ›¸æˆ¿

- ğŸ“šé¦¬å ´ï¼ˆ2019ï¼‰ã€Rã¨Stanã§ã¯ã˜ã‚ã‚‹ã€€ãƒ™ã‚¤ã‚ºçµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ†æå…¥é–€ã€è¬›è«‡ç¤¾

- ğŸ“šGelman, Hill, & Vehtari (2020) *Regression and Other Stories*, Cambridge University Press

- ğŸ—£[ç”°æ‘ï¼ˆ2023ï¼‰ã€ŒRã‚’ç”¨ã„ãŸä¸€èˆ¬åŒ–ç·šå½¢æ··åˆãƒ¢ãƒ‡ãƒ«ï¼ˆGLMMï¼‰ã®åˆ†ææ‰‹æ³•ã‚’èº«ã«ã¤ã‘ã‚‹:è¨€èªç ”ç©¶åˆ†é‡ã®äº‹ä¾‹ã‚’ã‚‚ã¨ã«ã€æ—¥æœ¬è¨€èªãƒ†ã‚¹ãƒˆå­¦ä¼šï¼ˆJLTAï¼‰ç¬¬26å›ï¼ˆ2023å¹´åº¦ï¼‰å…¨å›½ç ”ç©¶å¤§ä¼šãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—](https://tam07pb915.github.io/JLTA_2023_WS/#(1))

- ğŸ“„[è‰è–™ (2017). ç¢ºç‡åˆ†å¸ƒã‹ã‚‰è¦‹ã‚‹å¤–å›½èªæ•™è‚²ç ”ç©¶ãƒ‡ãƒ¼ã‚¿. ãƒ¡ã‚½ãƒ‰ãƒ­ã‚¸ãƒ¼ç ”ç©¶éƒ¨ä¼šå ±å‘Šè«–é›†, 10, 1-40.](https://www.mizumot.com/method/10_01_Kusanagi.pdf)

- ğŸ“„[Terai, M., Fukuta, J., & Tamura, Y. (2024). Learnability of L2 collocations and L1 influence on L2 collocational representations of Japanese learners of English. *International Review of Applied Linguistics in Language Teaching, 62*(4), 1959-1983.](https://www.degruyterbrill.com/document/doi/10.1515/iral-2022-0234/html)

- ğŸ’»[ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°](https://hkawabata.github.io/technical-note/note/ML/logistic-regression.html)

- ğŸ’»[ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°åˆ†æ1](https://bellcurve.jp/statistics/course/26934.html?srsltid=AfmBOorwQsuSpgEx3zQ8gVhrS2zSP50-PUvuzRlNqNP-rxWB2J_XBwyf)

```{=html}
<style>
.infobox {
  padding: 1em 1em 1em 4em;
  margin-bottom: 10px;
  border: 2px solid orange;
  border-radius: 10px;
  background: #f5f5f5 5px center/3em no-repeat;
}

.beg {
  background-image: url("https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjHtu3kBX8P39WYBBAjar9c8c1ladK2SYL6_gEMXFweQfauWVhSvCQP5KELsPX5KNL1uOddLLQ-aeMxv904OW_NFFfANhBYObfBV09KO2EXehrb9kMdCLZY1afsChib-7zIkBJbG6OrbJpM/s400/aisatsu_kodomo_boy.png");}

.caution {
  background-image: url("https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzMqkpQ7vLUKvumbm6AFwTLQiCe7tlDb2Q0MAiISLsesZHnhj0kbRjB4U3se3UrDIHfIy0hlahyphenhyphenQu-V2tOR2LcV_lX7U8P5a8jtqPYv3Ah4L-JoYi8PhoaoehumGIdp2vrsX0rRyhXqwA/s800/mark_chuui.png");}
  
</style>
```